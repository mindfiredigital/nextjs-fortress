"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[646],{6493(e,n,t){t.d(n,{R:()=>o,x:()=>c});var s=t(2128);const r={},i=s.createContext(r);function o(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(i.Provider,{value:n},e.children)}},8350(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"modules/deserialization/dangerous-keys","title":"Dangerous Keys Detection","description":"Overview","source":"@site/docs/modules/deserialization/dangerous-keys.md","sourceDirName":"modules/deserialization","slug":"/modules/deserialization/dangerous-keys","permalink":"/nextjs-fortress/docs/modules/deserialization/dangerous-keys","draft":false,"unlisted":false,"editUrl":"https://github.com/mindfiredigital/nextjs-fortress/tree/main/docs/docs/modules/deserialization/dangerous-keys.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Quick Start Guide","permalink":"/nextjs-fortress/docs/quick-start"},"next":{"title":"Depth Limiting Protection","permalink":"/nextjs-fortress/docs/modules/deserialization/depth-limiting"}}');var r=t(7900),i=t(6493);const o={},c="Dangerous Keys Detection",l={},d=[{value:"Overview",id:"overview",level:2},{value:"Why This Is Important",id:"why-this-is-important",level:2},{value:"The Problem: Prototype Pollution",id:"the-problem-prototype-pollution",level:3},{value:"1. <strong>The <code>__proto__</code> Attack</strong>",id:"1-the-__proto__-attack",level:4},{value:"2. <strong>The <code>constructor</code> Attack</strong>",id:"2-the-constructor-attack",level:4},{value:"3. <strong>The <code>prototype</code> Attack</strong>",id:"3-the-prototype-attack",level:4},{value:"4. <strong>Hidden Properties Attack</strong>",id:"4-hidden-properties-attack",level:4},{value:"How nextjs-fortress Solves This",id:"how-nextjs-fortress-solves-this",level:2},{value:"The Algorithm",id:"the-algorithm",level:3},{value:"Why This Works",id:"why-this-works",level:3},{value:"The Blocklist Explained",id:"the-blocklist-explained",level:2},{value:"How to Initialize",id:"how-to-initialize",level:2},{value:"Summary",id:"summary",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"dangerous-keys-detection",children:"Dangerous Keys Detection"})}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(n.p,{children:["Dangerous keys detection is the ",(0,r.jsx)(n.strong,{children:"primary defense"})," against prototype pollution attacks, including CVE-2025-55182. It identifies and blocks object properties that can modify JavaScript's prototype chain."]}),"\n",(0,r.jsx)(n.h2,{id:"why-this-is-important",children:"Why This Is Important"}),"\n",(0,r.jsx)(n.h3,{id:"the-problem-prototype-pollution",children:"The Problem: Prototype Pollution"}),"\n",(0,r.jsxs)(n.p,{children:["JavaScript's prototype chain is fundamental but dangerous. Every object inherits from ",(0,r.jsx)(n.code,{children:"Object.prototype"}),", and modifying it affects ",(0,r.jsx)(n.strong,{children:"every object in your application"}),"."]}),"\n",(0,r.jsxs)(n.h4,{id:"1-the-__proto__-attack",children:["1. ",(0,r.jsxs)(n.strong,{children:["The ",(0,r.jsx)(n.code,{children:"__proto__"})," Attack"]})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'// Attacker sends this payload\nconst malicious = {\n  "username": "admin",\n  "__proto__": {\n    "isAdmin": true\n  }\n};\n\n// Without protection:\nObject.prototype.isAdmin = true;\n\n// Now EVERY object is an admin\nconst normalUser = {};\nconsole.log(normalUser.isAdmin); // true \n\n// Authentication bypass\nfunction checkAdmin(user) {\n  if (user.isAdmin) {\n    return "ACCESS GRANTED";\n  }\n  return "ACCESS DENIED";\n}\n\ncheckAdmin({}); // "ACCESS GRANTED" \n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"What Happens Without Protection:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"All objects inherit malicious properties"}),"\n",(0,r.jsx)(n.li,{children:"Authentication logic bypassed"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Impact:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Complete security bypass - Any user becomes admin"}),"\n",(0,r.jsx)(n.li,{children:"Unauthorized access to all data"}),"\n",(0,r.jsx)(n.li,{children:"Financial fraud possible"}),"\n",(0,r.jsx)(n.li,{children:"Loss of customer trust"}),"\n"]}),"\n",(0,r.jsxs)(n.h4,{id:"2-the-constructor-attack",children:["2. ",(0,r.jsxs)(n.strong,{children:["The ",(0,r.jsx)(n.code,{children:"constructor"})," Attack"]})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'// Attacker payload\nconst malicious = {\n  "constructor": {\n    "prototype": {\n      "infected": true,\n      "executeCode": function() {\n        require(\'child_process\').exec(\'rm -rf /\');\n      }\n    }\n  }\n};\n\n// Without protection:\nObject.constructor.prototype.executeCode = function() { /* evil */ };\n\n// Now every object has malicious methods\nconst anyObject = {};\nanyObject.executeCode(); // RCE achieved\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"What Happens Without Protection:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Custom methods added to all objects"}),"\n",(0,r.jsx)(n.li,{children:"Code execution possible"}),"\n",(0,r.jsx)(n.li,{children:"Server compromise achieved"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Impact:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Remote Code Execution (RCE)"}),"\n",(0,r.jsx)(n.li,{children:"File system access"}),"\n",(0,r.jsx)(n.li,{children:"Steal API keys and secrets"}),"\n",(0,r.jsx)(n.li,{children:"Install backdoors"}),"\n"]}),"\n",(0,r.jsxs)(n.h4,{id:"3-the-prototype-attack",children:["3. ",(0,r.jsxs)(n.strong,{children:["The ",(0,r.jsx)(n.code,{children:"prototype"})," Attack"]})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'// Attacker creates custom class\nclass User {\n  constructor(data) {\n    Object.assign(this, data);\n  }\n}\n\n// Attacker sends\nconst malicious = {\n  "name": "John",\n  "prototype": {\n    "role": "superadmin"\n  }\n};\n\nconst user = new User(malicious);\n\n// Without protection:\nUser.prototype.role = "superadmin";\n\n// All User instances are now superadmin\nconst attacker = new User({ name: "Attacker" });\nconsole.log(attacker.role); // "superadmin" \n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"What Happens Without Protection:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Class prototypes modified"}),"\n",(0,r.jsx)(n.li,{children:"All instances affected"}),"\n",(0,r.jsx)(n.li,{children:"Privilege escalation achieved"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Impact:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Privilege escalation (User \u2192 SuperAdmin)"}),"\n",(0,r.jsx)(n.li,{children:"All future instances compromised"}),"\n"]}),"\n",(0,r.jsxs)(n.h4,{id:"4-hidden-properties-attack",children:["4. ",(0,r.jsx)(n.strong,{children:"Hidden Properties Attack"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'// Sophisticated attacker uses non-enumerable properties\nconst malicious = {\n  "username": "user123"\n};\n\nObject.defineProperty(malicious, \'__proto__\', {\n  value: { isAdmin: true },\n  enumerable: false,  // Hidden from Object.keys()\n});\n\n// Traditional check FAILS\nconsole.log(Object.keys(malicious)); // ["username"] - looks safe!\nconsole.log(malicious.__proto__);     // { isAdmin: true } - but isn\'t!\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"What Happens Without Protection:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Hidden properties go undetected"}),"\n",(0,r.jsx)(n.li,{children:"Object appears safe"}),"\n",(0,r.jsx)(n.li,{children:"Attack succeeds silently"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Impact:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Stealth attacks bypass logging"}),"\n",(0,r.jsx)(n.li,{children:"Detection evasion"}),"\n",(0,r.jsx)(n.li,{children:"Time bomb - activates later"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"how-nextjs-fortress-solves-this",children:"How nextjs-fortress Solves This"}),"\n",(0,r.jsx)(n.h3,{id:"the-algorithm",children:"The Algorithm"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"/**\n * Check for dangerous keys that could lead to prototype pollution\n */\nprivate checkDangerousKeys(\n  obj: unknown,\n  path: string = ''\n): ValidationResult {\n  if (obj === null || typeof obj !== 'object') {\n    return { valid: true };\n  }\n\n  const target = obj as Record<string, unknown>;\n\n  // 1. Get ALL keys (including non-enumerable)\n  const keys = Reflect.ownKeys(target);\n\n  for (const key of keys) {\n    if (typeof key !== 'string') continue;\n\n    const lowerKey = key.toLowerCase();\n\n    // 2. Check against blocklist\n    if (this.blockList.has(lowerKey)) {\n      return {\n        valid: false,\n        severity: 'critical',\n        message: `Dangerous key detected: \"${key}\" at path \"${path}\"`,\n        rule: 'dangerous_key',\n        pattern: key,\n        confidence: 1.0,\n      };\n    }\n\n    const currentPath = path ? `${path}.${key}` : key;\n\n    // 3. Recursively check nested objects\n    try {\n      const result = this.checkDangerousKeys(target[key], currentPath);\n      if (!result.valid) return result;\n    } catch {\n      continue;\n    }\n  }\n\n  // 4. THE CRITICAL CHECK: Prototype validation\n  const proto = Object.getPrototypeOf(obj);\n  if (proto && proto !== Object.prototype && proto !== Array.prototype) {\n    return {\n      valid: false,\n      severity: 'critical',\n      message: `Custom prototype detected at path \"${path}\"`,\n      rule: 'custom_prototype_detected',\n      confidence: 1.0,\n    };\n  }\n\n  return { valid: true };\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"why-this-works",children:"Why This Works"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"1. Comprehensive Detection"})," - Uses ",(0,r.jsx)(n.code,{children:"Reflect.ownKeys()"})," to catch hidden properties\n",(0,r.jsx)(n.strong,{children:"2. Case-Insensitive"})," - Catches ",(0,r.jsx)(n.code,{children:"__proto__"}),", ",(0,r.jsx)(n.code,{children:"__Proto__"}),", ",(0,r.jsx)(n.code,{children:"__PROTO__"}),"\n",(0,r.jsx)(n.strong,{children:"3. Prototype Validation"})," - Detects swapped prototype chains\n",(0,r.jsx)(n.strong,{children:"4. Deep Scanning"})," - Recursively checks all nested levels"]}),"\n",(0,r.jsx)(n.h2,{id:"the-blocklist-explained",children:"The Blocklist Explained"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Key"}),(0,r.jsx)(n.th,{children:"Why Dangerous"}),(0,r.jsx)(n.th,{children:"Attack Vector"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"__proto__"})}),(0,r.jsx)(n.td,{children:"Direct prototype access"}),(0,r.jsx)(n.td,{children:"Pollutes Object.prototype"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"constructor"})}),(0,r.jsx)(n.td,{children:"Access to constructor function"}),(0,r.jsx)(n.td,{children:"Modifies constructor.prototype"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"prototype"})}),(0,r.jsx)(n.td,{children:"Class prototype"}),(0,r.jsx)(n.td,{children:"Affects all class instances"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"__defineGetter__"})}),(0,r.jsx)(n.td,{children:"Define property getters"}),(0,r.jsx)(n.td,{children:"Custom property behavior"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"__defineSetter__"})}),(0,r.jsx)(n.td,{children:"Define property setters"}),(0,r.jsx)(n.td,{children:"Custom property behavior"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"toString"})}),(0,r.jsx)(n.td,{children:"Object string conversion"}),(0,r.jsx)(n.td,{children:"Override default behavior"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"valueOf"})}),(0,r.jsx)(n.td,{children:"Object primitive conversion"}),(0,r.jsx)(n.td,{children:"Type coercion attacks"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"hasOwnProperty"})}),(0,r.jsx)(n.td,{children:"Property existence check"}),(0,r.jsx)(n.td,{children:"Logic bypass"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"how-to-initialize",children:"How to Initialize"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { FortressConfig, FortressLogger } from '@mindfiredigital/nextjs-fortress';\n\nexport const fortressConfig: FortressConfig = {\n  enabled: true,\n  mode: 'development',\n\n  modules: {\n    deserialization: {\n      enabled: true,              // Always enabled\n      maxDepth: 10,\n      detectCircular: true,\n      \n      blockList: [                // Dangerous keys to block\n        '__proto__',\n        'constructor',\n        'prototype',\n        '__defineGetter__',\n        '__defineSetter__',\n        '__lookupGetter__',\n        '__lookupSetter__',\n        'toString',\n        'valueOf',\n        'hasOwnProperty',\n      ],\n    },\n  },\n\n  onSecurityEvent: async (event) => {\n    const logger = new FortressLogger({\n      enabled: true,\n      level: 'warn',\n      destination: 'console',\n    });\n\n    if (event.detection.rule === 'dangerous_key') {\n      logger.warn('\ud83d\udea8 Prototype Pollution Attempt Blocked', {\n        key: event.detection.pattern,\n        ip: event.request.ip,\n        path: event.request.path,\n      });\n    }\n  },\n};\n"})}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"What happens without dangerous keys detection:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Prototype pollution succeeds"}),"\n",(0,r.jsx)(n.li,{children:"Authentication bypass"}),"\n",(0,r.jsx)(n.li,{children:"Privilege escalation"}),"\n",(0,r.jsx)(n.li,{children:"Remote code execution"}),"\n",(0,r.jsx)(n.li,{children:"Complete security collapse"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"What nextjs-fortress provides:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Comprehensive key scanning"}),"\n",(0,r.jsx)(n.li,{children:"Non-enumerable property detection"}),"\n",(0,r.jsx)(n.li,{children:"Prototype chain validation"}),"\n",(0,r.jsx)(n.li,{children:"Recursive inspection"}),"\n",(0,r.jsx)(n.li,{children:"Custom blocklist support"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"How to initialize:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"deserialization: {\n  enabled: true,              // Always enabled\n  blockList: [                // Dangerous keys\n    '__proto__',\n    'constructor',\n    'prototype',\n    // Add custom keys here\n  ],\n}\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Related Documentation:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/nextjs-fortress/docs/modules/deserialization/depth-limiting",children:"Depth Limiting"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/nextjs-fortress/docs/modules/deserialization/circular-references",children:"Circular References"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/nextjs-fortress/docs/modules/deserialization/dangerous-patterns",children:"Dangerous Patterns"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/nextjs-fortress/docs/cve/cve-2025-55182",children:"CVE-2025-55182 Details"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}}}]);