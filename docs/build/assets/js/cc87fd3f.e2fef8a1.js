"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[519],{6493(e,n,t){t.d(n,{R:()=>a,x:()=>o});var s=t(2128);const r={},i=s.createContext(r);function a(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(i.Provider,{value:n},e.children)}},7162(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"modules/deserialization/dangerous-patterns","title":"Dangerous Patterns Detection","description":"Overview","source":"@site/docs/modules/deserialization/dangerous-patterns.md","sourceDirName":"modules/deserialization","slug":"/modules/deserialization/dangerous-patterns","permalink":"/nextjs-fortress/docs/modules/deserialization/dangerous-patterns","draft":false,"unlisted":false,"editUrl":"https://github.com/mindfiredigital/nextjs-fortress/tree/main/docs/docs/modules/deserialization/dangerous-patterns.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Circular Reference Detection","permalink":"/nextjs-fortress/docs/modules/deserialization/circular-references"},"next":{"title":"SQL Injection Protection","permalink":"/nextjs-fortress/docs/modules/injection/sql-injection"}}');var r=t(7900),i=t(6493);const a={},o="Dangerous Patterns Detection",l={},c=[{value:"Overview",id:"overview",level:2},{value:"Why This Is Important",id:"why-this-is-important",level:2},{value:"The Problem: Malicious String Patterns",id:"the-problem-malicious-string-patterns",level:3},{value:"1. <strong>React Flight Exploitation Patterns</strong>",id:"1-react-flight-exploitation-patterns",level:4},{value:"2. <strong>Code Injection Patterns</strong>",id:"2-code-injection-patterns",level:4},{value:"3. <strong>Malware Dropper Markers</strong>",id:"3-malware-dropper-markers",level:4},{value:"4. <strong>Path Traversal Patterns</strong>",id:"4-path-traversal-patterns",level:4},{value:"How nextjs-fortress Solves This",id:"how-nextjs-fortress-solves-this",level:2},{value:"The Algorithm",id:"the-algorithm",level:3},{value:"Default Dangerous Patterns",id:"default-dangerous-patterns",level:3},{value:"Why This Works",id:"why-this-works",level:3},{value:"Pattern Categories",id:"pattern-categories",level:2},{value:"React Server Components (RSC) Patterns",id:"react-server-components-rsc-patterns",level:3},{value:"Code Injection Patterns",id:"code-injection-patterns",level:3},{value:"File System Patterns",id:"file-system-patterns",level:3},{value:"How to Initialize",id:"how-to-initialize",level:2},{value:"Summary",id:"summary",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"dangerous-patterns-detection",children:"Dangerous Patterns Detection"})}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"Dangerous patterns detection identifies malicious strings and code patterns within payload values that indicate attacks like code injection, malware droppers, or exploitation attempts."}),"\n",(0,r.jsx)(n.h2,{id:"why-this-is-important",children:"Why This Is Important"}),"\n",(0,r.jsx)(n.h3,{id:"the-problem-malicious-string-patterns",children:"The Problem: Malicious String Patterns"}),"\n",(0,r.jsx)(n.p,{children:"Even if an object doesn't have dangerous keys, its values can contain exploit patterns:"}),"\n",(0,r.jsxs)(n.h4,{id:"1-react-flight-exploitation-patterns",children:["1. ",(0,r.jsx)(n.strong,{children:"React Flight Exploitation Patterns"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'// Attacker payload contains React internals\n{\n  "data": "resolved_model",\n  "payload": "_response",\n  "marker": "_prefix"\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"What Happens Without Protection:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"React Server Components use these internal markers"}),"\n",(0,r.jsx)(n.li,{children:"Attacker can manipulate React Flight protocol"}),"\n",(0,r.jsx)(n.li,{children:"Server-side state corruption"}),"\n",(0,r.jsx)(n.li,{children:"Potential RCE through React internals"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Impact:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"React Flight protocol manipulation"}),"\n",(0,r.jsx)(n.li,{children:"Server-side state corruption"}),"\n",(0,r.jsx)(n.li,{children:"Remote code execution through RSC"}),"\n",(0,r.jsx)(n.li,{children:"CVE-2025-55182 exploitation"}),"\n"]}),"\n",(0,r.jsxs)(n.h4,{id:"2-code-injection-patterns",children:["2. ",(0,r.jsx)(n.strong,{children:"Code Injection Patterns"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'// Attacker tries to inject Node.js code\n{\n  "command": "require(\'child_process\').exec(\'whoami\')",\n  "module": "process.env.API_KEY",\n  "exploit": "eval(\'malicious code\')"\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"What Happens Without Protection:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["If application uses ",(0,r.jsx)(n.code,{children:"eval()"})," or ",(0,r.jsx)(n.code,{children:"Function()"})]}),"\n",(0,r.jsx)(n.li,{children:"Attacker code gets executed"}),"\n",(0,r.jsx)(n.li,{children:"Server compromise achieved"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Impact:"})," Arbitrary code execution File system access Environment variable theft Network access"]}),"\n",(0,r.jsxs)(n.h4,{id:"3-malware-dropper-markers",children:["3. ",(0,r.jsx)(n.strong,{children:"Malware Dropper Markers"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'// Known malware patterns\n{\n  "install": "_formdata",\n  "payload": "execsync",\n  "backdoor": "spawn"\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"What Happens Without Protection:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Malware installation attempted"}),"\n",(0,r.jsx)(n.li,{children:"Backdoor creation"}),"\n",(0,r.jsx)(n.li,{children:"Persistent access established"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Impact:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Malware installation"}),"\n",(0,r.jsx)(n.li,{children:"Backdoor creation"}),"\n",(0,r.jsx)(n.li,{children:"Persistent compromise"}),"\n",(0,r.jsx)(n.li,{children:"Command & control connectio"}),"\n"]}),"\n",(0,r.jsxs)(n.h4,{id:"4-path-traversal-patterns",children:["4. ",(0,r.jsx)(n.strong,{children:"Path Traversal Patterns"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'// Attacker tries to access sensitive files\n{\n  "file": "__dirname/../../etc/passwd",\n  "path": "__filename/../.env"\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"What Happens Without Protection:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Access to system files"}),"\n",(0,r.jsx)(n.li,{children:"Environment variable exposure"}),"\n",(0,r.jsx)(n.li,{children:"Source code leak"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Impact:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Unauthorized file access"}),"\n",(0,r.jsx)(n.li,{children:"Credential exposure"}),"\n",(0,r.jsx)(n.li,{children:"Source code theft"}),"\n",(0,r.jsx)(n.li,{children:"Configuration leak"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"how-nextjs-fortress-solves-this",children:"How nextjs-fortress Solves This"}),"\n",(0,r.jsx)(n.h3,{id:"the-algorithm",children:"The Algorithm"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"/**\n * Check for dangerous patterns in stringified values\n */\nprivate checkDangerousPatterns(obj: unknown): ValidationResult {\n  try {\n    // Stringify entire object to search for patterns\n    const stringified = JSON.stringify(obj).toLowerCase();\n\n    for (const pattern of this.dangerousPatterns) {\n      pattern.lastIndex = 0; // Reset regex state\n      const match = pattern.exec(stringified);\n\n      if (match) {\n        return {\n          valid: false,\n          severity: 'high',\n          message: `Dangerous pattern detected: \"${match[0]}\"`,\n          rule: 'dangerous_pattern',\n          pattern: match[0],\n          confidence: 0.95,\n        };\n      }\n    }\n\n    return { valid: true };\n  } catch {\n    // If stringification fails, treat as suspicious\n    return {\n      valid: false,\n      severity: 'medium',\n      message: 'Could not stringify payload for pattern detection',\n      rule: 'stringification_failed',\n      confidence: 0.7,\n    };\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"default-dangerous-patterns",children:"Default Dangerous Patterns"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"export const DEFAULT_DANGEROUS_PATTERNS = [\n  'resolved_model',      // React Flight internal state\n  '_response',           // RSC internal\n  '_prefix',             // Malware dropper marker\n  '_formdata',           // Form data hijacking\n  'child_process',       // Command execution\n  'require',             // Module loading\n  'eval',                // Code evaluation\n  'function',            // Function constructor\n  'import\\\\(',           // Dynamic imports\n  '__dirname',           // Node.js path access\n  '__filename',          // Node.js path access\n  'process\\\\.env',       // Environment variables\n  'fs\\\\.readfile',       // File system access\n  'fs\\\\.writefile',      // File system access\n  'execsync',            // Command execution\n  'spawn',               // Process spawning\n];\n"})}),"\n",(0,r.jsx)(n.h3,{id:"why-this-works",children:"Why This Works"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"1. Comprehensive Coverage"})," - Detects React internals, code injection, and malware patterns\n",(0,r.jsx)(n.strong,{children:"2. Case-Insensitive"})," - Converts to lowercase before matching\n",(0,r.jsx)(n.strong,{children:"3. Regex-Based"})," - Flexible pattern matching\n",(0,r.jsx)(n.strong,{children:"4. Fast Scanning"})," - Single stringify operation"]}),"\n",(0,r.jsx)(n.h2,{id:"pattern-categories",children:"Pattern Categories"}),"\n",(0,r.jsx)(n.h3,{id:"react-server-components-rsc-patterns",children:"React Server Components (RSC) Patterns"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"[\n  'resolved_model',   // React Flight state marker\n  '_response',        // RSC response object\n  '_prefix',          // RSC prefix marker\n  '_formdata',        // Form data manipulation\n]\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Why Blocked:"})," These patterns indicate attempts to manipulate React's internal protocol, which was the core of CVE-2025-55182."]}),"\n",(0,r.jsx)(n.h3,{id:"code-injection-patterns",children:"Code Injection Patterns"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"[\n  'require',          // CommonJS module loading\n  'eval',             // Direct code evaluation\n  'function',         // Function constructor\n  'import\\\\(',        // Dynamic imports\n  'child_process',    // Process spawning\n  'execsync',         // Synchronous execution\n  'spawn',            // Async process spawn\n]\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Why Blocked:"})," These patterns enable arbitrary code execution if the application processes them unsafely."]}),"\n",(0,r.jsx)(n.h3,{id:"file-system-patterns",children:"File System Patterns"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"[\n  '__dirname',        // Current directory path\n  '__filename',       // Current file path\n  'fs\\\\.readfile',    // File reading\n  'fs\\\\.writefile',   // File writing\n  'process\\\\.env',    // Environment variables\n]\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Why Blocked:"})," These patterns indicate attempts to access the file system or environment variables."]}),"\n",(0,r.jsx)(n.h2,{id:"how-to-initialize",children:"How to Initialize"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { FortressConfig, FortressLogger } from '@mindfiredigital/nextjs-fortress';\n\nexport const fortressConfig: FortressConfig = {\n  enabled: true,\n  mode: 'development',\n\n  modules: {\n    deserialization: {\n      enabled: true,\n      maxDepth: 10,\n      detectCircular: true,\n      \n      blockList: [\n        '__proto__',\n        'constructor',\n        'prototype',\n      ],\n      \n      // Optional: Add custom patterns\n      dangerousPatterns: [\n        'your_internal_api',\n        'admin_backdoor',\n        'debug_override',\n      ],\n    },\n  },\n\n  onSecurityEvent: async (event) => {\n    if (event.detection.rule === 'dangerous_pattern') {\n      const logger = new FortressLogger({\n        enabled: true,\n        level: 'warn',\n        destination: 'console',\n      });\n\n      logger.warn('\ud83d\udd0d Dangerous Pattern Detected', {\n        pattern: event.detection.pattern,\n        ip: event.request.ip,\n        path: event.request.path,\n      });\n    }\n  },\n};\n"})}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"What happens without pattern detection:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"React Flight exploitation succeeds"}),"\n",(0,r.jsx)(n.li,{children:"Code injection possible"}),"\n",(0,r.jsx)(n.li,{children:"Malware installation"}),"\n",(0,r.jsx)(n.li,{children:"File system access"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"What nextjs-fortress provides:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"RSC pattern detection"}),"\n",(0,r.jsx)(n.li,{children:"Code injection prevention"}),"\n",(0,r.jsx)(n.li,{children:"Malware marker detection"}),"\n",(0,r.jsx)(n.li,{children:"Custom pattern support"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"How to initialize:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"deserialization: {\n  enabled: true,\n  dangerousPatterns: [  // Optional: defaults applied\n    'resolved_model',\n    'child_process',\n    'eval',\n    // Add custom patterns\n  ],\n}\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Related Documentation:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/nextjs-fortress/docs/modules/deserialization/dangerous-keys",children:"Dangerous Keys Detection"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/nextjs-fortress/docs/modules/deserialization/depth-limiting",children:"Depth Limiting"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/nextjs-fortress/docs/modules/deserialization/circular-references",children:"Circular References"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/nextjs-fortress/docs/cve/cve-2025-55182",children:"CVE-2025-55182 Details"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);