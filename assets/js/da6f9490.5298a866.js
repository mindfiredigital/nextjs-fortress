"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[50],{4380(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"modules/injection/code-injection","title":"code-injection","description":"Code Injection Protection","source":"@site/docs/modules/injection/code-injection.md","sourceDirName":"modules/injection","slug":"/modules/injection/code-injection","permalink":"/nextjs-fortress/docs/modules/injection/code-injection","draft":false,"unlisted":false,"editUrl":"https://github.com/mindfiredigital/nextjs-fortress/tree/main/docs/docs/modules/injection/code-injection.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"XSS Protection (Cross-Site Scripting)","permalink":"/nextjs-fortress/docs/modules/injection/xss-protection"},"next":{"title":"Ghost Mode Protection (Encoding Bypass)","permalink":"/nextjs-fortress/docs/modules/encoding/ghost-mode"}}');var s=t(7900),r=t(6493);const c={},o=void 0,l={},a=[{value:"Overview",id:"overview",level:2},{value:"Why This Is Important",id:"why-this-is-important",level:2},{value:"The Problem: Code Injection Attacks",id:"the-problem-code-injection-attacks",level:3},{value:"1. <strong>eval() Exploitation</strong>",id:"1-eval-exploitation",level:4},{value:"2. <strong>Function Constructor Attack</strong>",id:"2-function-constructor-attack",level:4},{value:"3. <strong>setTimeout/setInterval String Injection</strong>",id:"3-settimeoutsetinterval-string-injection",level:4},{value:"4. <strong>Constructor Prototype Injection</strong>",id:"4-constructor-prototype-injection",level:4},{value:"How nextjs-fortress Solves This",id:"how-nextjs-fortress-solves-this",level:2},{value:"Detection Patterns",id:"detection-patterns",level:3},{value:"The Algorithm",id:"the-algorithm",level:3},{value:"Attack Examples",id:"attack-examples",level:2},{value:"Example 1: eval() Injection",id:"example-1-eval-injection",level:3},{value:"Example 2: Function Constructor",id:"example-2-function-constructor",level:3},{value:"Example 3: setTimeout String",id:"example-3-settimeout-string",level:3},{value:"Example 4: Constructor Chain",id:"example-4-constructor-chain",level:3},{value:"Dangerous Patterns Explained",id:"dangerous-patterns-explained",level:2},{value:"How to Initialize",id:"how-to-initialize",level:2},{value:"Summary",id:"summary",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Code Injection Protection"}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.p,{children:["Code injection protection detects and blocks malicious JavaScript code patterns that could be executed via ",(0,s.jsx)(n.code,{children:"eval()"}),", ",(0,s.jsx)(n.code,{children:"Function()"}),", or other dynamic code execution methods."]}),"\n",(0,s.jsx)(n.h2,{id:"why-this-is-important",children:"Why This Is Important"}),"\n",(0,s.jsx)(n.h3,{id:"the-problem-code-injection-attacks",children:"The Problem: Code Injection Attacks"}),"\n",(0,s.jsx)(n.p,{children:"Attackers inject executable code that runs in the application context:"}),"\n",(0,s.jsxs)(n.h4,{id:"1-eval-exploitation",children:["1. ",(0,s.jsx)(n.strong,{children:"eval() Exploitation"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// Calculator app that evaluates expressions\n{\n  "expression": "eval(\'require(\\"child_process\\").exec(\\"whoami\\")\')"\n}\n\n// Without protection, if app uses:\nconst result = eval(userInput);\n// Executes: eval(eval(\'require("child_process").exec("whoami")\'))\n// Result: Command execution, server compromise\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"What Happens Without Protection:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Code executed in application context"}),"\n",(0,s.jsx)(n.li,{children:"Full Node.js API access"}),"\n",(0,s.jsx)(n.li,{children:"Server compromise"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Impact"}),": Remote code executi Full API acce File system contr Network access"]}),"\n",(0,s.jsxs)(n.h4,{id:"2-function-constructor-attack",children:["2. ",(0,s.jsx)(n.strong,{children:"Function Constructor Attack"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// Dynamic function creation\n{\n  "code": "Function(\'return process.env\')().DATABASE_PASSWORD"\n}\n\n// Without protection:\nconst fn = new Function(userCode);\n// Executes: Function that accesses process.env\n// Result: Environment variables stolen\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"What Happens Without Protection:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Function constructor bypasses restrictions"}),"\n",(0,s.jsx)(n.li,{children:"Environment variables accessed"}),"\n",(0,s.jsx)(n.li,{children:"Secrets exposed"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Impact:"})," Credential theft API key exposure Database passwords stolen Targeted data theft"]}),"\n",(0,s.jsxs)(n.h4,{id:"3-settimeoutsetinterval-string-injection",children:["3. ",(0,s.jsx)(n.strong,{children:"setTimeout/setInterval String Injection"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// Delayed execution\n{\n  "delay": "1000",\n  "action": "require(\'fs\').readFileSync(\'/etc/passwd\')"\n}\n\n// Without protection:\nsetTimeout(userAction, delay);\n// Executes: setTimeout("require(\'fs\').readFileSync(\'/etc/passwd\')", 1000)\n// Result: File system access after delay\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"What Happens Without Protection:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"String-based setTimeout executes code"}),"\n",(0,s.jsx)(n.li,{children:"File system accessed"}),"\n",(0,s.jsx)(n.li,{children:"Data stolen"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Impact:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Delayed attacks"}),"\n",(0,s.jsx)(n.li,{children:"File access"}),"\n",(0,s.jsx)(n.li,{children:"Stealth exploitation"}),"\n",(0,s.jsx)(n.li,{children:"Security bypass"}),"\n"]}),"\n",(0,s.jsxs)(n.h4,{id:"4-constructor-prototype-injection",children:["4. ",(0,s.jsx)(n.strong,{children:"Constructor Prototype Injection"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// Access constructor to create functions\n{\n  "data": "constructor.constructor(\'return process\')()"\n}\n\n// Without protection:\nconst obj = {};\nobj.constructor.constructor === Function; // true\n// Can execute arbitrary code\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"What Happens Without Protection:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Constructor chain access"}),"\n",(0,s.jsx)(n.li,{children:"Function creation"}),"\n",(0,s.jsx)(n.li,{children:"Code execution"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Impact:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Bypass restrictions"}),"\n",(0,s.jsx)(n.li,{children:"Arbitrary execution"}),"\n",(0,s.jsx)(n.li,{children:"Security escape"}),"\n",(0,s.jsx)(n.li,{children:"Full control"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"how-nextjs-fortress-solves-this",children:"How nextjs-fortress Solves This"}),"\n",(0,s.jsx)(n.h3,{id:"detection-patterns",children:"Detection Patterns"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export const CODE_INJECTION_PATTERNS = [\n  /eval\\s*\\(/gi,                          // eval() calls\n  /Function\\s*\\(/gi,                      // Function constructor\n  /setTimeout\\s*\\(\\s*[\"']/gi,             // String-based setTimeout\n  /setInterval\\s*\\(\\s*[\"']/gi,            // String-based setInterval\n  /\\.constructor\\s*\\(/gi,                 // Constructor access\n  /import\\s*\\(/gi,                        // Dynamic imports\n  /require\\s*\\(/gi,                       // CommonJS require\n];\n"})}),"\n",(0,s.jsx)(n.h3,{id:"the-algorithm",children:"The Algorithm"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"/**\n * Check for code injection patterns\n */\nprivate checkPatterns(\n  str: string,\n  patterns: RegExp[],\n  type: string\n): ValidationResult {\n  for (const pattern of patterns) {\n    pattern.lastIndex = 0;\n    const match = pattern.exec(str);\n\n    if (match) {\n      return {\n        valid: false,\n        severity: 'critical',\n        message: `Code injection detected: \"${match[0]}\"`,\n        rule: 'code_injection',\n        pattern: match[0],\n        confidence: 0.9,\n      };\n    }\n  }\n\n  return { valid: true };\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"attack-examples",children:"Attack Examples"}),"\n",(0,s.jsx)(n.h3,{id:"example-1-eval-injection",children:"Example 1: eval() Injection"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// Calculator request\nPOST /api/calculate\n{\n  "formula": "eval(\'process.exit(1)\')"\n}\n\n// Fortress detects:\n// Pattern match: "eval(" found\n// Severity: critical\n// Result: BLOCKED \u2705\n'})}),"\n",(0,s.jsx)(n.h3,{id:"example-2-function-constructor",children:"Example 2: Function Constructor"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// Dynamic code execution\nPOST /api/execute\n{\n  "code": "Function(\'return process.env\')()"\n}\n\n// Fortress detects:\n// Pattern match: "Function(" found\n// Result: BLOCKED \u2705\n'})}),"\n",(0,s.jsx)(n.h3,{id:"example-3-settimeout-string",children:"Example 3: setTimeout String"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// Delayed action\nPOST /api/schedule\n{\n  "action": "require(\'fs\').writeFileSync(\'/tmp/backdoor\', \'evil\')",\n  "delay": 5000\n}\n\n// Fortress detects:\n// Pattern match: "require(" found\n// Result: BLOCKED \u2705\n'})}),"\n",(0,s.jsx)(n.h3,{id:"example-4-constructor-chain",children:"Example 4: Constructor Chain"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// Prototype chain exploitation\nPOST /api/process\n{\n  "data": "{}.constructor.constructor(\'return this\')()"\n}\n\n// Fortress detects:\n// Pattern match: ".constructor(" found\n// Result: BLOCKED \u2705\n'})}),"\n",(0,s.jsx)(n.h2,{id:"dangerous-patterns-explained",children:"Dangerous Patterns Explained"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Pattern"}),(0,s.jsx)(n.th,{children:"Risk"}),(0,s.jsx)(n.th,{children:"Why Blocked"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"eval()"})}),(0,s.jsx)(n.td,{children:"Critical"}),(0,s.jsx)(n.td,{children:"Direct code execution"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Function()"})}),(0,s.jsx)(n.td,{children:"Critical"}),(0,s.jsx)(n.td,{children:"Creates executable functions"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'setTimeout("code")'})}),(0,s.jsx)(n.td,{children:"High"}),(0,s.jsx)(n.td,{children:"String-based execution"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'setInterval("code")'})}),(0,s.jsx)(n.td,{children:"High"}),(0,s.jsx)(n.td,{children:"Repeated execution"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:".constructor()"})}),(0,s.jsx)(n.td,{children:"Critical"}),(0,s.jsx)(n.td,{children:"Bypass restrictions"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"import()"})}),(0,s.jsx)(n.td,{children:"High"}),(0,s.jsx)(n.td,{children:"Dynamic module loading"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"require()"})}),(0,s.jsx)(n.td,{children:"Critical"}),(0,s.jsx)(n.td,{children:"Node.js module access"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"how-to-initialize",children:"How to Initialize"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { FortressConfig, FortressLogger } from '@mindfiredigital/nextjs-fortress';\n\nexport const fortressConfig: FortressConfig = {\n  enabled: true,\n  mode: 'development',\n\n  modules: {\n    injection: {\n      enabled: true,\n      checks: ['codeInjection'],\n    },\n  },\n\n  onSecurityEvent: async (event) => {\n    if (event.detection.rule === 'code_injection') {\n      const logger = new FortressLogger({\n        enabled: true,\n        level: 'warn',\n        destination: 'console',\n      });\n\n      logger.warn('\ud83d\udcbb Code Injection Blocked', {\n        pattern: event.detection.pattern,\n        ip: event.request.ip,\n        path: event.request.path,\n      });\n    }\n  },\n};\n"})}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"What happens without code injection protection:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Arbitrary code execution"}),"\n",(0,s.jsx)(n.li,{children:"Process manipulation"}),"\n",(0,s.jsx)(n.li,{children:"Environment access"}),"\n",(0,s.jsx)(n.li,{children:"Complete compromise"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"What nextjs-fortress provides:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"eval() detection"}),"\n",(0,s.jsx)(n.li,{children:"Function constructor blocking"}),"\n",(0,s.jsx)(n.li,{children:"setTimeout/setInterval protection"}),"\n",(0,s.jsx)(n.li,{children:"Constructor chain prevention"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"How to initialize:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"injection: {\n  enabled: true,\n  checks: ['codeInjection'],\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Related Documentation:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/nextjs-fortress/docs/modules/injection/sql-injection",children:"SQL Injection Protection"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/nextjs-fortress/docs/modules/injection/command-injection",children:"Command Injection Protection"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/nextjs-fortress/docs/modules/injection/xss-protection",children:"XSS Protection"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},6493(e,n,t){t.d(n,{R:()=>c,x:()=>o});var i=t(2128);const s={},r=i.createContext(s);function c(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);