"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[816],{1523(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"modules/rate-limit/rate-limiting","title":"Rate Limiting Protection","description":"Overview","source":"@site/docs/modules/rate-limit/rate-limiting.md","sourceDirName":"modules/rate-limit","slug":"/modules/rate-limit/rate-limiting","permalink":"/nextjs-fortress/docs/modules/rate-limit/rate-limiting","draft":false,"unlisted":false,"editUrl":"https://github.com/mindfiredigital/nextjs-fortress/tree/main/docs/docs/modules/rate-limit/rate-limiting.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"CSRF Protection (Cross-Site Request Forgery)","permalink":"/nextjs-fortress/docs/modules/csrf/csrf-protection"},"next":{"title":"API Routes Wrapper","permalink":"/nextjs-fortress/docs/wrappers/api-route"}}');var s=t(4848),r=t(8453);const a={},o="Rate Limiting Protection",l={},c=[{value:"Overview",id:"overview",level:2},{value:"Why This Is Important",id:"why-this-is-important",level:2},{value:"The Problem: Unlimited Request Abuse",id:"the-problem-unlimited-request-abuse",level:3},{value:"1. <strong>Brute-Force Password Attacks</strong>",id:"1-brute-force-password-attacks",level:4},{value:"2. <strong>Denial of Service (DoS)</strong>",id:"2-denial-of-service-dos",level:4},{value:"3. <strong>Data Scraping</strong>",id:"3-data-scraping",level:4},{value:"4. <strong>API Abuse / Resource Exhaustion</strong>",id:"4-api-abuse--resource-exhaustion",level:4},{value:"How nextjs-fortress Solves This",id:"how-nextjs-fortress-solves-this",level:2},{value:"The Algorithm",id:"the-algorithm",level:3},{value:"Middleware Integration",id:"middleware-integration",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Basic Setup (IP-Based)",id:"basic-setup-ip-based",level:3},{value:"Session-Based Rate Limiting",id:"session-based-rate-limiting",level:3},{value:"Endpoint-Specific Limits",id:"endpoint-specific-limits",level:3},{value:"With Backoff",id:"with-backoff",level:3},{value:"Real Implementation Examples",id:"real-implementation-examples",level:2},{value:"Middleware (Automatic)",id:"middleware-automatic",level:3},{value:"API Route (Custom Limits)",id:"api-route-custom-limits",level:3},{value:"Server Action (Rate Limited)",id:"server-action-rate-limited",level:3},{value:"Attack Prevention Examples",id:"attack-prevention-examples",level:2},{value:"Example 1: Brute Force Login",id:"example-1-brute-force-login",level:3},{value:"Example 2: DoS Attack",id:"example-2-dos-attack",level:3},{value:"Example 3: Data Scraping",id:"example-3-data-scraping",level:3},{value:"Rate Limit Headers",id:"rate-limit-headers",level:2},{value:"How to Initialize",id:"how-to-initialize",level:2},{value:"Common Configurations",id:"common-configurations",level:2},{value:"Strict (High Security)",id:"strict-high-security",level:3},{value:"Moderate (Balanced)",id:"moderate-balanced",level:3},{value:"Relaxed (User-Friendly)",id:"relaxed-user-friendly",level:3},{value:"Summary",id:"summary",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"rate-limiting-protection",children:"Rate Limiting Protection"})}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"Rate limiting restricts the number of requests from a single IP or session within a time window to prevent brute-force attacks, DoS, and API abuse."}),"\n",(0,s.jsx)(n.h2,{id:"why-this-is-important",children:"Why This Is Important"}),"\n",(0,s.jsx)(n.h3,{id:"the-problem-unlimited-request-abuse",children:"The Problem: Unlimited Request Abuse"}),"\n",(0,s.jsx)(n.p,{children:"Without rate limiting, attackers can flood your application:"}),"\n",(0,s.jsxs)(n.h4,{id:"1-brute-force-password-attacks",children:["1. ",(0,s.jsx)(n.strong,{children:"Brute-Force Password Attacks"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Attacker tries 1000 passwords per second\nfor (let i = 0; i < 1000000; i++) {\n  fetch('/api/auth/login', {\n    method: 'POST',\n    body: JSON.stringify({\n      username: 'admin',\n      password: commonPasswords[i]\n    })\n  });\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"What Happens Without Protection:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Unlimited login attempts"}),"\n",(0,s.jsx)(n.li,{children:"Password eventually cracked"}),"\n",(0,s.jsx)(n.li,{children:"Account compromised"}),"\n"]}),"\n",(0,s.jsxs)(n.h4,{id:"2-denial-of-service-dos",children:["2. ",(0,s.jsx)(n.strong,{children:"Denial of Service (DoS)"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Attacker floods API with requests\nwhile (true) {\n  fetch('/api/expensive-operation', {\n    method: 'POST',\n    body: JSON.stringify({ data: 'x'.repeat(1000000) })\n  });\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"What Happens Without Protection:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Server overwhelmed"}),"\n",(0,s.jsx)(n.li,{children:"CPU/memory exhausted"}),"\n",(0,s.jsx)(n.li,{children:"Application crashes"}),"\n",(0,s.jsx)(n.li,{children:"All users affected"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Impact:"})," Service outage Business disruption Revenue loss Customer complaints"]}),"\n",(0,s.jsxs)(n.h4,{id:"3-data-scraping",children:["3. ",(0,s.jsx)(n.strong,{children:"Data Scraping"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Attacker scrapes all user profiles\nfor (let id = 1; id <= 1000000; id++) {\n  const user = await fetch(`/api/user/${id}`);\n  await saveToDatabase(user);\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"What Happens Without Protection:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Entire database scraped"}),"\n",(0,s.jsx)(n.li,{children:"User data stolen"}),"\n",(0,s.jsx)(n.li,{children:"Competitive intelligence gathered"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Impact:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Data theft"}),"\n",(0,s.jsx)(n.li,{children:"Privacy violations"}),"\n",(0,s.jsx)(n.li,{children:"Competitive disadvantage"}),"\n",(0,s.jsx)(n.li,{children:"Legal liability"}),"\n"]}),"\n",(0,s.jsxs)(n.h4,{id:"4-api-abuse--resource-exhaustion",children:["4. ",(0,s.jsx)(n.strong,{children:"API Abuse / Resource Exhaustion"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Attacker generates expensive reports repeatedly\nfor (let i = 0; i < 10000; i++) {\n  fetch('/api/reports/generate', {\n    method: 'POST',\n    body: JSON.stringify({ \n      dateRange: 'all',\n      includeAll: true \n    })\n  });\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"What Happens Without Protection:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Server resources consumed"}),"\n",(0,s.jsx)(n.li,{children:"Database overloaded"}),"\n",(0,s.jsx)(n.li,{children:"Response times increase"}),"\n",(0,s.jsx)(n.li,{children:"Costs skyrocket"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Impact:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Excessive cloud bills"}),"\n",(0,s.jsx)(n.li,{children:"Performance degradation"}),"\n",(0,s.jsx)(n.li,{children:"Database overload"}),"\n",(0,s.jsx)(n.li,{children:"Financial damage"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"how-nextjs-fortress-solves-this",children:"How nextjs-fortress Solves This"}),"\n",(0,s.jsx)(n.h3,{id:"the-algorithm",children:"The Algorithm"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"/**\n * Rate limiter - isolated rate limiting logic\n */\nexport class RateLimiter {\n  private store = new Map<string, RateLimitEntry>();\n\n  async check(request: NextRequest): Promise<RateLimitResult> {\n    const ip = request.headers.get('x-forwarded-for') || 'unknown';\n    const now = Date.now();\n    const rateLimitConfig = this.config.modules.rateLimit;\n\n    if (!rateLimitConfig.byIP) {\n      return { allowed: true };\n    }\n\n    const key = `ip:${ip}`;\n    const limit = rateLimitConfig.byIP;\n    const entry = this.store.get(key);\n\n    // Create new entry\n    if (!entry || now > entry.resetAt) {\n      this.store.set(key, {\n        count: 1,\n        resetAt: now + limit.window,\n      });\n      return { allowed: true };\n    }\n\n    // Check if limit exceeded\n    if (entry.count >= limit.requests) {\n      return {\n        allowed: false,\n        response: new NextResponse('Too Many Requests', {\n          status: 429,\n          headers: {\n            'Retry-After': String(Math.ceil((entry.resetAt - now) / 1000)),\n          },\n        }),\n      };\n    }\n\n    // Increment count\n    entry.count++;\n    this.store.set(key, entry);\n\n    return { allowed: true };\n  }\n\n  cleanup(): void {\n    const now = Date.now();\n    for (const [key, entry] of this.store.entries()) {\n      if (now > entry.resetAt) {\n        this.store.delete(key);\n      }\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"middleware-integration",children:"Middleware Integration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// middleware/index.ts\nexport function createFortressMiddleware(config: FortressConfig) {\n  const rateLimiter = new RateLimiter(config);\n\n  return async function fortressMiddleware(request: NextRequest) {\n    // Check rate limit\n    if (config.modules.rateLimit.enabled) {\n      const rateLimitResult = await rateLimiter.check(request);\n      if (!rateLimitResult.allowed) {\n        return rateLimitResult.response; // Returns 429\n      }\n    }\n\n    // Continue with other validations...\n    return NextResponse.next();\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsx)(n.h3,{id:"basic-setup-ip-based",children:"Basic Setup (IP-Based)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { FortressConfig } from 'nextjs-fortress';\n\nexport const fortressConfig: FortressConfig = {\n  modules: {\n    rateLimit: {\n      enabled: true,\n      byIP: {\n        requests: 100,     // 100 requests\n        window: 60000,     // per 60 seconds (1 minute)\n      },\n    },\n  },\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"session-based-rate-limiting",children:"Session-Based Rate Limiting"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export const fortressConfig: FortressConfig = {\n  modules: {\n    rateLimit: {\n      enabled: true,\n      byIP: {\n        requests: 100,\n        window: 60000,\n      },\n      bySession: {\n        requests: 50,      // 50 requests\n        window: 60000,     // per session per minute\n      },\n    },\n  },\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"endpoint-specific-limits",children:"Endpoint-Specific Limits"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export const fortressConfig: FortressConfig = {\n  modules: {\n    rateLimit: {\n      enabled: true,\n      byIP: {\n        requests: 100,\n        window: 60000,\n      },\n      endpoints: {\n        '/api/auth/login': {\n          requests: 5,       // Only 5 login attempts\n          window: 300000,    // per 5 minutes\n        },\n        '/api/reports/generate': {\n          requests: 10,      // 10 report generations\n          window: 3600000,   // per hour\n        },\n      },\n    },\n  },\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"with-backoff",children:"With Backoff"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export const fortressConfig: FortressConfig = {\n  modules: {\n    rateLimit: {\n      enabled: true,\n      byIP: {\n        requests: 100,\n        window: 60000,\n      },\n      backoff: {\n        enabled: true,\n        multiplier: 2,       // Double delay each time\n        maxDelay: 300000,    // Max 5 minutes\n      },\n    },\n  },\n};\n"})}),"\n",(0,s.jsx)(n.h2,{id:"real-implementation-examples",children:"Real Implementation Examples"}),"\n",(0,s.jsx)(n.h3,{id:"middleware-automatic",children:"Middleware (Automatic)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// middleware.ts\nimport { createFortressMiddleware } from 'nextjs-fortress';\nimport { fortressConfig } from './fortress.config';\n\nexport const middleware = createFortressMiddleware(fortressConfig);\n\n// Rate limiting applies to all routes\nexport const config = {\n  matcher: ['/((?!_next/static|_next/image|favicon.ico).*)'],\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"api-route-custom-limits",children:"API Route (Custom Limits)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// app/api/login/route.ts\nimport { withFortress } from 'nextjs-fortress';\n\nexport const POST = withFortress(\n  async (request) => {\n    const { username, password } = await request.json();\n    \n    // Authenticate user\n    const user = await authenticateUser(username, password);\n    \n    return Response.json({ success: true, user });\n  },\n  {\n    rateLimit: {\n      requests: 5,       // Only 5 login attempts\n      window: 300000,    // per 5 minutes\n    },\n  }\n);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"server-action-rate-limited",children:"Server Action (Rate Limited)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// app/actions.ts\n'use server';\n\nimport { secureServerAction } from 'nextjs-fortress';\n\nexport const sendEmail = secureServerAction(\n  async (to: string, subject: string, body: string) => {\n    await emailService.send({ to, subject, body });\n    return { success: true };\n  },\n  {\n    rateLimitKey: 'send-email', // Custom key for this action\n  }\n);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"attack-prevention-examples",children:"Attack Prevention Examples"}),"\n",(0,s.jsx)(n.h3,{id:"example-1-brute-force-login",children:"Example 1: Brute Force Login"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Attacker tries multiple passwords\nPOST /api/auth/login (attempt 1) \u2705\nPOST /api/auth/login (attempt 2) \u2705\nPOST /api/auth/login (attempt 3) \u2705\nPOST /api/auth/login (attempt 4) \u2705\nPOST /api/auth/login (attempt 5) \u2705\nPOST /api/auth/login (attempt 6) \u274c\n\n// Fortress response:\nStatus: 429 Too Many Requests\nRetry-After: 300 (seconds)\n\n// Result: Attack stopped after 5 attempts\n"})}),"\n",(0,s.jsx)(n.h3,{id:"example-2-dos-attack",children:"Example 2: DoS Attack"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// Attacker floods server\nPOST /api/data (1-100) \u2705 Allowed\nPOST /api/data (101) \u274c Rate limited\n\n// Response:\n{\n  "error": "Too Many Requests",\n  "retryAfter": 45\n}\n\n// All subsequent requests from IP blocked for 45 seconds\n'})}),"\n",(0,s.jsx)(n.h3,{id:"example-3-data-scraping",children:"Example 3: Data Scraping"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Scraper tries to get all users\nGET /api/user/1 \u2705\nGET /api/user/2 \u2705\n// ... 98 more requests\nGET /api/user/100 \u2705\nGET /api/user/101 \u274c\n\n// Rate limit exceeded\n// Scraping prevented\n"})}),"\n",(0,s.jsx)(n.h2,{id:"rate-limit-headers",children:"Rate Limit Headers"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Fortress adds these headers to responses\n\nX-RateLimit-Limit: 100          // Total allowed\nX-RateLimit-Remaining: 45       // Remaining in window\nX-RateLimit-Reset: 1641234567   // Unix timestamp\n\n// When rate limited:\nRetry-After: 45                 // Seconds until retry\n"})}),"\n",(0,s.jsx)(n.h2,{id:"how-to-initialize",children:"How to Initialize"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { FortressConfig, FortressLogger } from 'nextjs-fortress';\n\nexport const fortressConfig: FortressConfig = {\n  enabled: true,\n  mode: 'development',\n\n  modules: {\n    rateLimit: {\n      enabled: true,\n      \n      // Global IP-based limit\n      byIP: {\n        requests: 100,\n        window: 60000,\n      },\n      \n      // Session-based limit\n      bySession: {\n        requests: 50,\n        window: 60000,\n      },\n      \n      // Endpoint-specific limits\n      endpoints: {\n        '/api/auth/login': {\n          requests: 5,\n          window: 300000,\n        },\n      },\n      \n      // Whitelisted IPs (no limits)\n      whitelist: [\n        '127.0.0.1',\n        '::1',\n      ],\n    },\n  },\n\n  onSecurityEvent: async (event) => {\n    if (event.type === 'ratelimit') {\n      const logger = new FortressLogger({\n        enabled: true,\n        level: 'warn',\n        destination: 'console',\n      });\n\n      logger.warn('\ud83d\udea6 Rate Limit Exceeded', {\n        ip: event.request.ip,\n        path: event.request.path,\n        timestamp: event.timestamp,\n      });\n    }\n  },\n};\n"})}),"\n",(0,s.jsx)(n.h2,{id:"common-configurations",children:"Common Configurations"}),"\n",(0,s.jsx)(n.h3,{id:"strict-high-security",children:"Strict (High Security)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"byIP: {\n  requests: 50,\n  window: 60000,\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"moderate-balanced",children:"Moderate (Balanced)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"byIP: {\n  requests: 100,\n  window: 60000,\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"relaxed-user-friendly",children:"Relaxed (User-Friendly)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"byIP: {\n  requests: 200,\n  window: 60000,\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"What happens without rate limiting:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Brute-force attacks succeed"}),"\n",(0,s.jsx)(n.li,{children:"DoS attacks crash server"}),"\n",(0,s.jsx)(n.li,{children:"Data scraping steals information"}),"\n",(0,s.jsx)(n.li,{children:"API abuse costs money"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"What nextjs-fortress provides:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"IP-based limiting"}),"\n",(0,s.jsx)(n.li,{children:"Session-based limiting"}),"\n",(0,s.jsx)(n.li,{children:"Endpoint-specific limits"}),"\n",(0,s.jsx)(n.li,{children:"Automatic cleanup"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"How to initialize:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"rateLimit: {\n  enabled: true,\n  byIP: {\n    requests: 100,    // Requests allowed\n    window: 60000,    // Time window (ms)\n  },\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Related Documentation:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/nextjs-fortress/docs/modules/csrf/csrf-protection",children:"CSRF Protection"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453(e,n,t){t.d(n,{R:()=>a,x:()=>o});var i=t(6540);const s={},r=i.createContext(s);function a(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);