"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[830],{4871(e,n,s){s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"modules/deserialization/depth-limiting","title":"Depth Limiting Protection","description":"Overview","source":"@site/docs/modules/deserialization/depth-limiting.md","sourceDirName":"modules/deserialization","slug":"/modules/deserialization/depth-limiting","permalink":"/nextjs-fortress/docs/modules/deserialization/depth-limiting","draft":false,"unlisted":false,"editUrl":"https://github.com/mindfiredigital/nextjs-fortress/tree/main/docs/docs/modules/deserialization/depth-limiting.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Dangerous Keys Detection","permalink":"/nextjs-fortress/docs/modules/deserialization/dangerous-keys"},"next":{"title":"Circular Reference Detection","permalink":"/nextjs-fortress/docs/modules/deserialization/circular-references"}}');var t=s(4848),r=s(8453);const l={},o="Depth Limiting Protection",d={},a=[{value:"Overview",id:"overview",level:2},{value:"Why This Is Important",id:"why-this-is-important",level:2},{value:"The Problem: Deeply Nested Attack Payloads",id:"the-problem-deeply-nested-attack-payloads",level:3},{value:"1. <strong>Stack Overflow Attacks</strong>",id:"1-stack-overflow-attacks",level:4},{value:"2. <strong>Validation Bypass</strong>",id:"2-validation-bypass",level:4},{value:"3. <strong>Parser Exploitation</strong>",id:"3-parser-exploitation",level:4},{value:"4. <strong>Memory Exhaustion</strong>",id:"4-memory-exhaustion",level:4},{value:"How nextjs-fortress Solves This",id:"how-nextjs-fortress-solves-this",level:2},{value:"The Algorithm",id:"the-algorithm",level:3},{value:"Why This Works",id:"why-this-works",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Basic Setup",id:"basic-setup",level:3},{value:"Choosing the Right Depth Limit",id:"choosing-the-right-depth-limit",level:3},{value:"Environment-Based Configuration",id:"environment-based-configuration",level:3},{value:"How to Initialize",id:"how-to-initialize",level:2},{value:"Summary",id:"summary",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"depth-limiting-protection",children:"Depth Limiting Protection"})}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"Depth limiting prevents attackers from sending deeply nested objects to overwhelm your server, bypass validation, or exploit parsing vulnerabilities."}),"\n",(0,t.jsx)(n.h2,{id:"why-this-is-important",children:"Why This Is Important"}),"\n",(0,t.jsx)(n.h3,{id:"the-problem-deeply-nested-attack-payloads",children:"The Problem: Deeply Nested Attack Payloads"}),"\n",(0,t.jsx)(n.p,{children:"Attackers can craft malicious payloads with excessive nesting to:"}),"\n",(0,t.jsxs)(n.h4,{id:"1-stack-overflow-attacks",children:["1. ",(0,t.jsx)(n.strong,{children:"Stack Overflow Attacks"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "level1": {\n    "level2": {\n      "level3": {\n        // ... 1000+ levels deep\n        "level1000": {\n          "__proto__": {\n            "isAdmin": true\n          }\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"What Happens Without Protection:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"JavaScript call stack overflows"}),"\n",(0,t.jsxs)(n.li,{children:["Server crashes with ",(0,t.jsx)(n.code,{children:"RangeError: Maximum call stack size exceeded"})]}),"\n",(0,t.jsx)(n.li,{children:"Application becomes unavailable"}),"\n",(0,t.jsx)(n.li,{children:"Denial of Service (DoS) achieved"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Impact:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Application crashes and downtime"}),"\n",(0,t.jsx)(n.li,{children:"Continuous crash loops"}),"\n",(0,t.jsx)(n.li,{children:"CPU spikes and memory leaks"}),"\n",(0,t.jsx)(n.li,{children:"All users affected"}),"\n"]}),"\n",(0,t.jsxs)(n.h4,{id:"2-validation-bypass",children:["2. ",(0,t.jsx)(n.strong,{children:"Validation Bypass"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "user": {\n    "profile": {\n      "settings": {\n        "preferences": {\n          "security": {\n            "advanced": {\n              "deep": {\n                "hidden": {\n                  "backdoor": {\n                    "__proto__": {\n                      "isAdmin": true\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"What Happens Without Protection:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Shallow validators only check top 2-3 levels"}),"\n",(0,t.jsx)(n.li,{children:"Deep malicious payloads go undetected"}),"\n",(0,t.jsx)(n.li,{children:"Prototype pollution succeeds"}),"\n",(0,t.jsx)(n.li,{children:"Security breach achieved"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Impact:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Authentication bypass"}),"\n",(0,t.jsx)(n.li,{children:"Privilege escalation"}),"\n",(0,t.jsx)(n.li,{children:"Unauthorized data access"}),"\n"]}),"\n",(0,t.jsxs)(n.h4,{id:"3-parser-exploitation",children:["3. ",(0,t.jsx)(n.strong,{children:"Parser Exploitation"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'// Deeply nested arrays\n[[[[[[[[[[[[[[[["malicious"]]]]]]]]]]]]]]]\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"What Happens Without Protection:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"JSON parser works harder for each level"}),"\n",(0,t.jsx)(n.li,{children:"Exponential time complexity: O(n\xb2) or O(n\xb3)"}),"\n",(0,t.jsx)(n.li,{children:"Server becomes unresponsive"}),"\n",(0,t.jsx)(n.li,{children:"CPU usage spikes to 100%"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Impact:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Response time degradation"}),"\n",(0,t.jsx)(n.li,{children:"CPU exhaustion"}),"\n",(0,t.jsx)(n.li,{children:"Service degradation for all users"}),"\n"]}),"\n",(0,t.jsxs)(n.h4,{id:"4-memory-exhaustion",children:["4. ",(0,t.jsx)(n.strong,{children:"Memory Exhaustion"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Each level allocates memory\n// 1000 levels \xd7 100 bytes = 100KB per request\n// 1000 concurrent requests = 100MB\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"What Happens Without Protection:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Each nested level allocates memory"}),"\n",(0,t.jsx)(n.li,{children:"Memory not released until request completes"}),"\n",(0,t.jsx)(n.li,{children:"Multiple concurrent requests multiply impact"}),"\n",(0,t.jsx)(n.li,{children:"Server runs out of memory"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Impact:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Out of Memory errors and crashes"}),"\n",(0,t.jsx)(n.li,{children:"Garbage collection storms"}),"\n",(0,t.jsx)(n.li,{children:"Performance degradation"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"how-nextjs-fortress-solves-this",children:"How nextjs-fortress Solves This"}),"\n",(0,t.jsx)(n.h3,{id:"the-algorithm",children:"The Algorithm"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"/**\n * Check nesting depth to prevent deeply nested attacks\n */\nprivate checkDepth(obj: unknown, currentDepth: number): ValidationResult {\n  // Base case: exceeded max depth\n  if (currentDepth > this.config.maxDepth) {\n    return {\n      valid: false,\n      severity: 'medium',\n      message: `Nesting depth exceeds maximum (${this.config.maxDepth})`,\n      rule: 'max_depth_exceeded',\n      confidence: 0.85,\n    }\n  }\n\n  // Not an object - no need to go deeper\n  if (obj === null || typeof obj !== 'object') {\n    return { valid: true }\n  }\n\n  // Recursively check all nested values\n  for (const value of Object.values(obj)) {\n    if (value !== null && typeof value === 'object') {\n      const result = this.checkDepth(value, currentDepth + 1)\n      if (!result.valid) {\n        return result // Stop immediately on failure\n      }\n    }\n  }\n\n  return { valid: true }\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"why-this-works",children:"Why This Works"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"1. Early Detection"})," - Stops immediately when limit exceeded\n",(0,t.jsx)(n.strong,{children:"2. Efficient Checking"})," - O(n) time, O(d) space\n",(0,t.jsx)(n.strong,{children:"3. Fast Performance"})," - <1ms for normal payloads\n",(0,t.jsx)(n.strong,{children:"4. Configurable Limits"})," - Adjust based on your needs"]}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsx)(n.h3,{id:"basic-setup",children:"Basic Setup"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { FortressConfig } from 'nextjs-fortress';\n\nexport const fortressConfig: FortressConfig = {\n  modules: {\n    deserialization: {\n      enabled: true,\n      maxDepth: 10,  // Blocks after 10 levels\n      detectCircular: true,\n    },\n  },\n};\n"})}),"\n",(0,t.jsx)(n.h3,{id:"choosing-the-right-depth-limit",children:"Choosing the Right Depth Limit"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Use Case"}),(0,t.jsx)(n.th,{children:"Recommended Depth"}),(0,t.jsx)(n.th,{children:"Reasoning"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Simple APIs"}),(0,t.jsx)(n.td,{children:"5-7"}),(0,t.jsx)(n.td,{children:"Most API requests don't need deep nesting"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"E-commerce"}),(0,t.jsx)(n.td,{children:"7-10"}),(0,t.jsx)(n.td,{children:"Product data, orders, cart items"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Social Media"}),(0,t.jsx)(n.td,{children:"8-10"}),(0,t.jsx)(n.td,{children:"Posts, comments, nested threads"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Complex Forms"}),(0,t.jsx)(n.td,{children:"10-15"}),(0,t.jsx)(n.td,{children:"Multi-step forms, nested fields"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Admin Dashboards"}),(0,t.jsx)(n.td,{children:"15-20"}),(0,t.jsx)(n.td,{children:"Complex analytics, nested reports"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"environment-based-configuration",children:"Environment-Based Configuration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const maxDepth = process.env.NODE_ENV === 'production' ? 10 : 15;\n\nexport const fortressConfig: FortressConfig = {\n  modules: {\n    deserialization: {\n      enabled: true,\n      maxDepth: maxDepth,\n      detectCircular: true,\n    },\n  },\n};\n"})}),"\n",(0,t.jsx)(n.h2,{id:"how-to-initialize",children:"How to Initialize"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { FortressConfig } from 'nextjs-fortress';\n\nexport const fortressConfig: FortressConfig = {\n  enabled: true,\n  mode: 'development',\n\n  modules: {\n    deserialization: {\n      enabled: true,\n      maxDepth: 10,              // Set depth limit\n      detectCircular: true,      // Enable circular detection\n      blockList: [               // Dangerous keys\n        '__proto__',\n        'constructor',\n        'prototype'\n      ],\n    },\n  },\n};\n"})}),"\n",(0,t.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"What happens without depth limiting:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Stack overflow crashes"}),"\n",(0,t.jsx)(n.li,{children:"DoS attacks succeed"}),"\n",(0,t.jsx)(n.li,{children:"Validation bypasses"}),"\n",(0,t.jsx)(n.li,{children:"Memory exhaustion"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"What nextjs-fortress provides:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Configurable depth limits"}),"\n",(0,t.jsx)(n.li,{children:"Early attack detection"}),"\n",(0,t.jsx)(n.li,{children:"Efficient validation"}),"\n",(0,t.jsx)(n.li,{children:"Zero performance impact"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"How to initialize:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"deserialization: {\n  enabled: true,\n  maxDepth: 10,  // Blocks after 10 levels\n  detectCircular: true,\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Related Documentation:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/nextjs-fortress/docs/modules/deserialization/dangerous-keys",children:"Dangerous Keys Detection"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/nextjs-fortress/docs/modules/deserialization/circular-references",children:"Circular Reference Detection"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/nextjs-fortress/docs/modules/deserialization/dangerous-patterns",children:"Dangerous Patterns Detection"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453(e,n,s){s.d(n,{R:()=>l,x:()=>o});var i=s(6540);const t={},r=i.createContext(t);function l(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);